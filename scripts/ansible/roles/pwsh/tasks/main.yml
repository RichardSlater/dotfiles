---
- name: Install PowerShell (pwsh) on Debian 12
  become: true
  block:
    - name: Install PowerShell on Debian/Ubuntu
      apt:
        deb: "https://github.com/PowerShell/PowerShell/releases/download/v{{ pwsh_target_version }}/powershell_{{ pwsh_target_version }}-1.deb_amd64.deb"
  when:
    - ansible_facts['os_family'] == "Debian"
    - ansible_facts['distribution_version'] == "12"

- name: Install PowerShell (pwsh) on Debian 13
  become: true
  block:
    - name: Install Microsoft Key
      apt:
        deb: "https://packages.microsoft.com/config/debian/13/packages-microsoft-prod.deb"
    - name: Install PowerShell on Debian/Ubuntu
      apt:
        deb: "https://github.com/rhubarb-geek-nz/powershell-ubuntu/releases/download/{{ pwsh_target_version }}/powershell_{{ pwsh_target_version }}-1.ubuntu_amd64.deb"
  when:
    - ansible_facts['os_family'] == "Debian"
    - ansible_facts['distribution_version'] == "13"

- name: Verify PowerShell Installation
  command: "pwsh --version"
  register: pwsh_version
  changed_when: false

- name: Show Installed PowerShell Version
  debug:
    msg: "Installed PowerShell Version: {{ pwsh_version.stdout }}"
